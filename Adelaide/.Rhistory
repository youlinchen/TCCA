xx = array( rnorm(n*p, mean=1, sd=sqrt(2.25)), c( n, p) )  ; for(i in 1:p) xx[,i]=xx[,i] + eta*array( rnorm(n), c(n,1) )
yy = xx%*%beta0+array( rnorm(n), c(n,1) )
y = yy ; X = xx
res = FRA( yy, xx, 100, variant)
res$jhat
res$beta0[1:5]
n=50 ; p=1000 ; eta = 0 ; rho = 0 ; y.col = 1 ; sigma.set=array( rho,c(y.col, y.col)) ; diag(sigma.set)=1  ;  xx=array(0,c(n,p))
#beta0=array( c( 3,-3.5,4,-2.8,3.2, rep(0,p-5) ), c(p,1) )
beta0=array( c( 3,-3.5,4,-2.8,3.2, 1.3, rep(0,p-6) ), c(p,1) )
Kn=min( floor(5*sqrt(n/log(p))), p)
xx = array( rnorm(n*p, mean=1, sd=sqrt(2.25)), c( n, p) )  ; for(i in 1:p) xx[,i]=xx[,i] + eta*array( rnorm(n), c(n,1) )
yy = xx%*%beta0+array( rnorm(n), c(n,1) )
y = yy ; X = xx
res = FRA( yy, xx, 100, variant)
res$jhat
res$beta0[1:5]
n=50 ; p=1000 ; eta = 0 ; rho = 0 ; y.col = 1 ; sigma.set=array( rho,c(y.col, y.col)) ; diag(sigma.set)=1  ;  xx=array(0,c(n,p))
#beta0=array( c( 3,-3.5,4,-2.8,3.2, rep(0,p-5) ), c(p,1) )
beta0=array( c( 3,-3.5,4,-2.8,3.2, 1.3, rep(0,p-6) ), c(p,1) )
Kn=min( floor(5*sqrt(n/log(p))), p)
xx = array( rnorm(n*p, mean=1, sd=sqrt(2.25)), c( n, p) )  ; for(i in 1:p) xx[,i]=xx[,i] + eta*array( rnorm(n), c(n,1) )
yy = xx%*%beta0+array( rnorm(n), c(n,1) )
y = yy ; X = xx
res = FRA( yy, xx, 100, variant)
res$jhat
res$beta0[1:5]
res$r
w=1
t=1
library(fds)
library(readr)
data(mondaytempkent)
data(tuesdaytempkent)
data(wednesdaytempkent)
data(thursdaytempkent)
data(fridaytempkent)
data(saturdaytempkent)
data(sundaytempkent)
data(mondaydemand)
data(tuesdaydemand)
data(wednesdaydemand)
data(thursdaydemand)
data(fridaydemand)
data(saturdaydemand)
data(sundaydemand)
demand=list(mondaydemand, tuesdaydemand, wednesdaydemand,
thursdaydemand, fridaydemand, saturdaydemand, sundaydemand)
tempkent = list(mondaytempkent, tuesdaytempkent, wednesdaytempkent,
thursdaytempkent, fridaytempkent, saturdaytempkent, sundaytempkent)
week = c("monday","tuesday","wednesday","thursday","friday","saturday","sunday")
data_adj = matrix(nrow=48, ncol=(508-52*2))
library(fds)
library(readr)
data(mondaytempkent)
data(tuesdaytempkent)
data(wednesdaytempkent)
data(thursdaytempkent)
data(fridaytempkent)
data(saturdaytempkent)
data(sundaytempkent)
data(mondaydemand)
data(tuesdaydemand)
data(wednesdaydemand)
data(thursdaydemand)
data(fridaydemand)
data(saturdaydemand)
data(sundaydemand)
demand=list(mondaydemand, tuesdaydemand, wednesdaydemand,
thursdaydemand, fridaydemand, saturdaydemand, sundaydemand)
tempkent = list(mondaytempkent, tuesdaytempkent, wednesdaytempkent,
thursdaytempkent, fridaytempkent, saturdaytempkent, sundaytempkent)
week = c("monday","tuesday","wednesday","thursday","friday","saturday","sunday")
data_adj = matrix(nrow=48, ncol=(508-52*2))
data <- ts(as.vector(demand[[w]]$y[t,]))
w=1
t=1
data <- ts(as.vector(demand[[w]]$y[t,]))
model=arima(log(data),order=c(0,0,0), seasonal = list(order = c(0, 1, 0), period=52))
plot(model$residuals)
plot(model$residuals[54:508])
lines(model$residuals[54:508])
plot(model$residuals[54:508],type = "l")
plot(model$residuals[54:508],type = "l")
acf(model$residuals[54:508],lag.max = 103)
acf(model$residuals[54:508],lag.max = 300)
pacf(model$residuals[54:508],lag.max = 300)
model=arima(log(data),order=c(0,0,0), seasonal = list(order = c(2, 1, 0), period=52))
plot(model$residuals[54:508],type = "l")
pacf(model$residuals[54:508],lag.max = 300)
acf(model$residuals[54:508],lag.max = 300)
model=arima(log(data),order=c(0,0,0), seasonal = list(order = c(2, 2, 0), period=52))
plot(model$residuals[52*2:508],type = "l")
plot(model$residuals[104:508],type = "l")
acf(model$residuals[104:508],lag.max = 300)
pacf(model$residuals[104:508],lag.max = 300)
model=arima(log(data),order=c(0,0,0), seasonal = list(order = c(2, 1, 0), period=52))
model
pacf(model$residuals[104:508],lag.max = 300)
model=arima(log(data),order=c(0,0,0), seasonal = list(order = c(2, 1, 0), period=52))
acf(model$residuals[53:508],lag.max = 300)
pacf(model$residuals[53:508],lag.max = 300)
acf(model$residuals[53:508],lag.max = 300)
model=arima(log(data),order=c(0,0,0), seasonal = list(order = c(2, 1, 2), period=52))
acf(model$residuals[53:508],lag.max = 300)
pacf(model$residuals[53:508],lag.max = 300)
pacf(model$residuals[53:105],lag.max = 300)
pacf(model$residuals[53:508],lag.max = 105)
pacf(model$residuals[53:508],lag.max = (52*4+1))
model=arima(log(data),order=c(0,0,0), seasonal = list(order = c(2, 1, 1), period=52))
pacf(model$residuals[53:508],lag.max = (52*4+1))
pacf(model$residuals[53:508],lag.max = (52*2+1))
setwd("~/Research/TCCA/real_data_analysis/Adelaide2")
demand=list(mondaydemand, tuesdaydemand,saturdaydemand, sundaydemand,
wednesdaydemand, thursdaydemand, fridaydemand)
# tempkent = list(mondaytempkent, tuesdaytempkent, saturdaytempkent, sundaytempkent,
#                 wednesdaytempkent, thursdaytempkent, fridaytempkent)
week = c("monday","tuesday","wednesday","thursday","friday","saturday","sunday")
data_adj = matrix(nrow=48, ncol=(508-52*2))
for (w in 1:7){
for (t in 1:48){
print(c(w,t))
data <- ts(as.vector(demand[[w]]$y[t,]))
model=arima(log(data),order=c(0,0,0), seasonal = list(order = c(2, 1, 2), period=52))
data_adj[t,]=model$residuals[(48*2+1):508]
}
filename = paste(week[w],"demand.csv",sep="")
write.csv(data_adj, file = filename)
}
data_adj = matrix(nrow=48, ncol=(508-52))
data_adj[t,]=model$residuals[53:508]
model$residuals[53:508]
model$residuals[52:508]
model$residuals[51:508]
data_adj[t,]=model$residuals[53:508]
View(data_adj)
library(fds)
library(readr)
data(mondaytempkent)
data(tuesdaytempkent)
data(wednesdaytempkent)
data(thursdaytempkent)
data(fridaytempkent)
data(saturdaytempkent)
data(sundaytempkent)
data(mondaydemand)
data(tuesdaydemand)
data(wednesdaydemand)
data(thursdaydemand)
data(fridaydemand)
data(saturdaydemand)
data(sundaydemand)
demand=list(mondaydemand, tuesdaydemand,saturdaydemand, sundaydemand,
wednesdaydemand, thursdaydemand, fridaydemand)
# tempkent = list(mondaytempkent, tuesdaytempkent, saturdaytempkent, sundaytempkent,
#                 wednesdaytempkent, thursdaytempkent, fridaytempkent)
week = c("monday","tuesday","wednesday","thursday","friday","saturday","sunday")
data_adj = matrix(nrow=48, ncol=(508-52))
for (w in 1:7){
for (t in 1:48){
print(c(w,t))
data <- ts(as.vector(demand[[w]]$y[t,]))
model=arima(log(data),order=c(0,0,0), seasonal = list(order = c(2, 1, 2), period=52))
data_adj[t,]=model$residuals[53:508]
}
filename = paste(week[w],"demand.csv",sep="")
write.csv(data_adj, file = filename)
}
data <- ts(as.vector(demand[[w]]$y[t,]))
model=arima(log(data),order=c(0,0,0), seasonal = list(order = c(2, 1, 0), period=52))
library(fds)
library(readr)
data(mondaytempkent)
data(tuesdaytempkent)
data(wednesdaytempkent)
data(thursdaytempkent)
data(fridaytempkent)
data(saturdaytempkent)
data(sundaytempkent)
data(mondaydemand)
data(tuesdaydemand)
data(wednesdaydemand)
data(thursdaydemand)
data(fridaydemand)
data(saturdaydemand)
data(sundaydemand)
demand=list(mondaydemand, tuesdaydemand,saturdaydemand, sundaydemand,
wednesdaydemand, thursdaydemand, fridaydemand)
# tempkent = list(mondaytempkent, tuesdaytempkent, saturdaytempkent, sundaytempkent,
#                 wednesdaytempkent, thursdaytempkent, fridaytempkent)
week = c("monday","tuesday","wednesday","thursday","friday","saturday","sunday")
data_adj = matrix(nrow=48, ncol=(508-52))
for (w in 1:7){
for (t in 1:48){
print(c(w,t))
data <- ts(as.vector(demand[[w]]$y[t,]))
model=arima(log(data),order=c(0,0,0), seasonal = list(order = c(2, 1, 0), period=52))
data_adj[t,]=model$residuals[53:508]
}
filename = paste(week[w],"demand.csv",sep="")
write.csv(data_adj, file = filename)
}
# for (w in 1:7){
#   filename = paste(week[w],"tempkent.csv",sep="")
#   write.csv(tempkent[[w]]$y, file = filename)
# }
#
# data_adj_m = read.csv("mondaydemand.csv",)
# data_adj_sat = read.csv("saturdaydemand.csv")
#
# data_adj_w = matrix(nrow=48, ncol=(508-48*2))
#
# data_adj_sun = matrix(nrow=48, ncol=(508-48*2))
acf(model)
acf(model$residuals,lag.max = 300)
acf(model$residuals,lag.max = 53)
pacf(model$residuals,lag.max = 53)
model=arima(log(data),order=c(3,0,6), seasonal = list(order = c(2, 1, 2), period=52))
model=arima(log(data),order=c(3,1,6), seasonal = list(order = c(2, 1, 2), period=52))
model=arima(log(data),order=c(3,0,4), seasonal = list(order = c(2, 1, 2), period=52))
model=arima(log(data),order=c(3,0,4), seasonal = list(order = c(2, 1, 1), period=52))
model=arima(log(data),order=c(3,0,4), seasonal = list(order = c(2, 1, 0), period=52))
data(mondaydemand)
data(tuesdaydemand)
data(wednesdaydemand)
data(thursdaydemand)
data(fridaydemand)
data(saturdaydemand)
data(sundaydemand)
me = median(mondaydemand)
me = median(mondaydemand$y)
View(mondaydemand)
48*508
48*508
View(mondaydemand)
?apple
?apply
me = apply(mondaydemand$y, 1, median)
demand_adj = mondaydemand$y
plot(demand_adj)
plot(mondaydemand$y)
plot.ts(mondaydemand$y)
plot(mondaydemand)
plot(demand_adj[1,])
mondaydemand$y = mondaydemand$y - me
plot(mondaydemand)
data(mondaytempkent)
data(mondaytempkent)
me = apply(mondaydemand$y, 1, median)
demand_adj = mondaydemand$y
mondaydemand$y = mondaydemand$y - me
data(mondaytempkent)
mondaydemand$y = log(mondaydemand$y)
me = apply(mondaydemand$y, 1, median)
mondaydemand$y = mondaydemand$y - me
plot(mondaydemand)
data(mondaytempkent)
data(mondaytempkent)
data(mondaydemand)
mondaydemand$y = log(mondaydemand$y)
me = apply(mondaydemand$y, 1, median)
mondaydemand$y = mondaydemand$y - me
plot(mondaydemand)
library(fds)
library(readr)
data(mondaytempkent)
data(tuesdaytempkent)
data(wednesdaytempkent)
data(thursdaytempkent)
data(fridaytempkent)
data(saturdaytempkent)
data(sundaytempkent)
data(mondaydemand)
data(tuesdaydemand)
data(wednesdaydemand)
data(thursdaydemand)
data(fridaydemand)
data(saturdaydemand)
data(sundaydemand)
demand=list(mondaydemand, tuesdaydemand,saturdaydemand, sundaydemand,
wednesdaydemand, thursdaydemand, fridaydemand)
tempkent = list(mondaytempkent, tuesdaytempkent, saturdaytempkent, sundaytempkent,
wednesdaytempkent, thursdaytempkent, fridaytempkent)
week = c("monday","tuesday","wednesday","thursday","friday","saturday","sunday")
data_adj = matrix(nrow=48, ncol=508)
for (w in 1:7){
data_adj = demand[[w]]$y
me = apply(data_adj, 1, median)
data_adj = data_adj - me
filename = paste(week[w],"demand_median_adj.csv",sep="")
write.csv(data_adj, file = filename)
}
setwd("~/Research/TCCA/real_data_analysis/Adelaide")
for (w in 1:7){
data_adj = log(demand[[w]]$y)
me = apply(data_adj, 1, median)
data_adj = data_adj - me
filename = paste(week[w],"demand_log_median_adj.csv",sep="")
write.csv(data_adj, file = filename)
}
for (w in 1:7){
data_adj = tempkent[[w]]$y
me = apply(data_adj, 1, median)
data_adj = data_adj - me
filename = paste(week[w],"temp_median_adj.csv",sep="")
write.csv(data_adj, file = filename)
}
plot(tempkent)
plot(tempkent[[1]])
plot(data_adj)
sundaytempkent$y = data_adj
plot(sundaytempkent)
for (w in 1:7){
data_adj = tempkent[[w]]$y
me = apply(data_adj, 1, median)
data_adj = data_adj - me
filename = paste(week[w],"tempkent_median_adj.csv",sep="")
write.csv(data_adj, file = filename)
}
setwd("~/Research/TCCA/PM25")
chinapm25_2012_2017 <- read_csv("~/Research/TCCA/PM25/chinapm25_2012_2017.csv")
library(readr)
chinapm25_2012_2017 <- read_csv("~/Research/TCCA/PM25/chinapm25_2012_2017.csv")
library(readr)
chinapm25_2012_2017 <- read_csv("~/Research/TCCA/PM25/chinapm25_2012_2017.csv")
mean(chinapm25_2012_2017$Guangzhou[c(13,25,37,49,61)+1])
mean(chinapm25_2012_2017$Guangzhou[c(13,25,37,49,61)+2])
plot(chinapm25_2012_2017$Beijing, type="l", col=4)
lines(chinapm25_2012_2017$Shanghai,col=3)
chipm25 = matrix(nrow = 12*4+6, ncol = 3)
for (i in 1:3){
dataChi = ts(chinapm25_2012_2017[,i], frequency=12, start=c(2012,1))
model=arima(dataChi,order=c(0,0,0), seasonal = list(order = c(1, 1, 1), period=12))
model_r=window(model$residuals,start=c(2013,1))
print(Box.test(model_r, lag=24, type="Ljung-Box"))
chipm25[,i] = as.matrix(model_r)
}
write.csv(data.frame(chipm25), file = "chipm25_adj.csv")
View(chipm25)
View(chinapm25_2012_2017)
mean(chinapm25_2012_2017$Guangzhou[c(13,25,37,49,61)+1])
mean(chinapm25_2012_2017$Guangzhou[c(13,25,37,49,61)+2])
mean(chinapm25_2012_2017$Guangzhou[c(13,25,37,49,61)+1])
mean(chinapm25_2012_2017$Guangzhou[c(13,25,37,49,61)+2])
median(chinapm25_2012_2017$Guangzhou[c(13,25,37,49,61)+1])
mean(chinapm25_2012_2017$Guangzhou[c(13,25,37,49,61)+2])
median(chinapm25_2012_2017$Guangzhou[c(13,25,37,49,61)+2])
chinapm25_2012_2017
chinapm25_2012_2017$Guangzhou[2]
chinapm25_2012_2017$Guangzhou[3]
chinapm25_2012_2017 <- read_csv("~/Research/TCCA/PM25/chinapm25_2012_2017.csv")
chinapm25_2012_2017$Guangzhou[2] = mean(chinapm25_2012_2017$Guangzhou[c(13,25,37,49,61)+1])
chinapm25_2012_2017$Guangzhou[3] = mean(chinapm25_2012_2017$Guangzhou[c(13,25,37,49,61)+2]
chinapm25_2012_2017$Guangzhou[2] = mean(chinapm25_2012_2017$Guangzhou[c(13,25,37,49,61)+1])
chinapm25_2012_2017$Guangzhou[3] = mean(chinapm25_2012_2017$Guangzhou[c(13,25,37,49,61)+2])
]
chinapm25_2012_2017$Guangzhou[2] = mean(chinapm25_2012_2017$Guangzhou[c(13,25,37,49,61)+1])
chinapm25_2012_2017$Guangzhou[3] = mean(chinapm25_2012_2017$Guangzhou[c(13,25,37,49,61)+2])
chinapm25_2012_2017 <- read_csv("~/Research/TCCA/PM25/chinapm25_2012_2017.csv")
chinapm25_2012_2017$Guangzhou[2] = mean(chinapm25_2012_2017$Guangzhou[c(13,25,37,49,61)+1])
chinapm25_2012_2017$Guangzhou[3] = mean(chinapm25_2012_2017$Guangzhou[c(13,25,37,49,61)+2])
View(chinapm25_2012_2017)
for (i in 1:3){
dataChi = ts(chinapm25_2012_2017[,i], frequency=12, start=c(2012,1))
model=arima(dataChi,order=c(0,0,0), seasonal = list(order = c(1, 1, 1), period=12))
model_r=window(model$residuals,start=c(2013,1))
print(Box.test(model_r, lag=24, type="Ljung-Box"))
chipm25[,i] = as.matrix(model_r)
}
write.csv(data.frame(chipm25), file = "chipm25_adj.csv")
library(fds)
library(readr)
data(mondaytempkent)
data(tuesdaytempkent)
data(wednesdaytempkent)
data(thursdaytempkent)
data(fridaytempkent)
data(saturdaytempkent)
data(sundaytempkent)
data(mondaydemand)
data(tuesdaydemand)
data(wednesdaydemand)
data(thursdaydemand)
data(fridaydemand)
data(saturdaydemand)
data(sundaydemand)
demand=list(mondaydemand,tuesdaydemand,wednesdaydemand,thursdaydemand,fridaydemand,
saturdaydemand, sundaydemand)
tempkent = list(mondaytempkent,tuesdaytempkent,wednesdaytempkent,thursdaytempkent,fridaytempkent,
saturdaytempkent, sundaytempkent)
week = c("monday","tuesday","wednesday","thursday","friday","saturday","sunday")
data_adj = matrix(nrow=48, ncol=508)
for (w in 1:7){
data_adj = demand[[w]]$y
me = apply(data_adj, 1, median)
data_adj = data_adj - me
filename = paste(week[w],"demand_median_adj.csv",sep="")
write.csv(data_adj, file = filename)
}
for (w in 1:7){
data_adj = log(demand[[w]]$y)
me = apply(data_adj, 1, median)
data_adj = data_adj - me
filename = paste(week[w],"demand_log_median_adj.csv",sep="")
write.csv(data_adj, file = filename)
}
for (w in 1:7){
data_adj = tempkent[[w]]$y
me = apply(data_adj, 1, median)
data_adj = data_adj - me
filename = paste(week[w],"tempkent_median_adj.csv",sep="")
write.csv(data_adj, file = filename)
}
library(fds)
library(readr)
data(mondaytempkent)
data(tuesdaytempkent)
data(wednesdaytempkent)
data(thursdaytempkent)
data(fridaytempkent)
data(saturdaytempkent)
data(sundaytempkent)
data(mondaydemand)
data(tuesdaydemand)
data(wednesdaydemand)
data(thursdaydemand)
data(fridaydemand)
data(saturdaydemand)
data(sundaydemand)
# demand=list(mondaydemand, tuesdaydemand,saturdaydemand, sundaydemand,
#             wednesdaydemand, thursdaydemand, fridaydemand)
# tempkent = list(mondaytempkent, tuesdaytempkent, saturdaytempkent, sundaytempkent,
#                 wednesdaytempkent, thursdaytempkent, fridaytempkent)
demand=list(mondaydemand, tuesdaydemand,
wednesdaydemand, thursdaydemand, fridaydemand,
saturdaydemand, sundaydemand)
tempkent = list(mondaytempkent, tuesdaytempkent,
wednesdaytempkent, thursdaytempkent, fridaytempkent,
saturdaytempkent, sundaytempkent)
week = c("monday","tuesday","wednesday","thursday","friday","saturday","sunday")
data_adj = matrix(nrow=48, ncol=508)
for (w in 1:7){
data_adj = demand[[w]]$y
me = apply(data_adj, 1, median)
data_adj = data_adj - me
filename = paste(week[w],"demand_median_adj.csv",sep="")
write.csv(data_adj, file = filename)
}
for (w in 1:7){
data_adj = log(demand[[w]]$y)
me = apply(data_adj, 1, median)
data_adj = data_adj - me
filename = paste(week[w],"demand_log_median_adj.csv",sep="")
write.csv(data_adj, file = filename)
}
for (w in 1:7){
data_adj = tempkent[[w]]$y
me = apply(data_adj, 1, median)
data_adj = data_adj - me
filename = paste(week[w],"tempkent_median_adj.csv",sep="")
write.csv(data_adj, file = filename)
}
setwd("~/Research/TCCA/real_data_analysis/Adelaide")
library(fds)
library(readr)
data(mondaytempkent)
data(tuesdaytempkent)
data(wednesdaytempkent)
data(thursdaytempkent)
data(fridaytempkent)
data(saturdaytempkent)
data(sundaytempkent)
data(mondaydemand)
data(tuesdaydemand)
data(wednesdaydemand)
data(thursdaydemand)
data(fridaydemand)
data(saturdaydemand)
data(sundaydemand)
# demand=list(mondaydemand, tuesdaydemand,saturdaydemand, sundaydemand,
#             wednesdaydemand, thursdaydemand, fridaydemand)
# tempkent = list(mondaytempkent, tuesdaytempkent, saturdaytempkent, sundaytempkent,
#                 wednesdaytempkent, thursdaytempkent, fridaytempkent)
demand=list(mondaydemand, tuesdaydemand,
wednesdaydemand, thursdaydemand, fridaydemand,
saturdaydemand, sundaydemand)
tempkent = list(mondaytempkent, tuesdaytempkent,
wednesdaytempkent, thursdaytempkent, fridaytempkent,
saturdaytempkent, sundaytempkent)
week = c("monday","tuesday","wednesday","thursday","friday","saturday","sunday")
data_adj = matrix(nrow=48, ncol=508)
for (w in 1:7){
data_adj = demand[[w]]$y
me = apply(data_adj, 1, median)
data_adj = data_adj - me
filename = paste(week[w],"demand_median_adj.csv",sep="")
write.csv(data_adj, file = filename)
}
for (w in 1:7){
data_adj = log(demand[[w]]$y)
me = apply(data_adj, 1, median)
data_adj = data_adj - me
filename = paste(week[w],"demand_log_median_adj.csv",sep="")
write.csv(data_adj, file = filename)
}
for (w in 1:7){
data_adj = tempkent[[w]]$y
me = apply(data_adj, 1, median)
data_adj = data_adj - me
filename = paste(week[w],"tempkent_median_adj.csv",sep="")
write.csv(data_adj, file = filename)
}
me
